# GraphQL Schema for Vendor Portal
# Week 4 Day 2: Vendor Management & Dashboard

# ========================================
# Enums
# ========================================

enum SubmissionStatus {
  DRAFT
  PENDING_REVIEW
  APPROVED
  REJECTED
  CHANGES_REQUESTED
}

enum TrainingStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  CERTIFIED
}

# ========================================
# Types
# ========================================
"""
Vendor Profile - Core vendor information
Progressive Disclosure Levels:
- Glance: company name, verification status, taxonomy score
- Scan: contact info, specializations, performance metrics
- Study: certifications, full business details, historical data
"""
type VendorProfile {
  id: ID!
  vendureSellerId: String!
  companyName: String!
  contactName: String
  contactEmail: String!
  contactPhone: String
  businessLicenseNumber: String
  taxId: String
  websiteUrl: String
  logoUrl: String
  description: String

  # Business details
  establishedYear: Int
  specializations: [String!]
  certifications: JSON

  # Performance metrics (Glance level)
  taxonomyAccuracyScore: Int!
  productApprovalRate: Float!
  averageResponseTimeHours: Int!

  # Account status
  isActive: Boolean!
  isVerified: Boolean!
  verificationDate: String
  onboardingCompleted: Boolean!
  onboardingCompletedAt: String

  # Relations
  statistics: VendorStatistics
  products: [Product!]
  qualityMetrics: VendorQualityMetrics

  createdAt: String!
  updatedAt: String!
}
"""
Vendor Statistics - Dashboard metrics
Progressive Disclosure:
- Glance: Total products, pending approvals, taxonomy score
- Scan: Sales metrics, active vs inactive products
- Study: Customer retention, detailed breakdowns
"""
type VendorStatistics {
  id: ID!
  vendorProfileId: ID!

  # Product metrics (Glance)
  totalProducts: Int!
  activeProducts: Int!
  pendingApprovalProducts: Int!
  rejectedProducts: Int!

  # Sales metrics (Scan)
  totalSalesAmount: Int!
  monthlySalesAmount: Int!
  yearlySalesAmount: Int!
  totalOrders: Int!
  averageOrderValue: Int!

  # Customer metrics (Study)
  totalCustomers: Int!
  repeatCustomers: Int!
  customerRetentionRate: Float!

  # Taxonomy metrics
  productsWithCompleteTaxonomy: Int!
  productsWithProtocols: Int!
  professionalProducts: Int!

  calculatedAt: String!
  periodStartDate: String
  periodEndDate: String

  createdAt: String!
  updatedAt: String!
}
"""
Product Submission - Workflow tracking
"""
type ProductSubmission {
  id: ID!
  vendorProfileId: ID!
  productId: ID
  submissionStatus: SubmissionStatus!

  # Validation
  taxonomyCompletenessScore: Int!
  validationErrors: [ValidationError!]
  validationWarnings: [ValidationWarning!]

  # Review
  reviewedBy: String
  reviewedAt: String
  reviewNotes: String
  rejectionReason: String

  # Training
  trainingCompleted: Boolean!
  trainingCompletedAt: String
  guidanceStepsCompleted: JSON

  submittedAt: String
  createdAt: String!
  updatedAt: String!
}
"""
Validation Error
"""
type ValidationError {
  field: String!
  message: String!
  severity: String!
  code: String
}
"""
Validation Warning
"""
type ValidationWarning {
  field: String!
  message: String!
  suggestion: String
}
"""
Vendor Training Progress
"""
type VendorTrainingProgress {
  id: ID!
  vendorProfileId: ID!

  # Module info
  moduleId: String!
  moduleName: String!
  moduleCategory: String

  # Progress
  status: TrainingStatus!
  progressPercentage: Int!

  # Completion
  startedAt: String
  completedAt: String
  timeSpentMinutes: Int!

  # Assessment
  quizScore: Int
  quizAttempts: Int!
  certificationEarned: Boolean!
  certificationExpiresAt: String

  createdAt: String!
  updatedAt: String!
}
"""
Vendor Quality Metrics
"""
type VendorQualityMetrics {
  id: ID!
  vendorProfileId: ID!

  # Taxonomy quality
  correctCategoryAssignments: Int!
  incorrectCategoryAssignments: Int!
  correctFunctionAssignments: Int!
  incorrectFunctionAssignments: Int!

  # Protocol quality
  protocolsProvided: Int!
  protocolsMissing: Int!
  protocolQualityScore: Int!

  # Image quality
  highQualityImages: Int!
  lowQualityImages: Int!
  missingImages: Int!

  # Description quality
  completeDescriptions: Int!
  incompleteDescriptions: Int!
  descriptionQualityScore: Int!

  # Compliance
  compliantProducts: Int!
  nonCompliantProducts: Int!
  complianceIssues: [ComplianceIssue!]

  # Overall
  overallQualityScore: Int!

  periodStartDate: String
  periodEndDate: String
  calculatedAt: String!

  createdAt: String!
  updatedAt: String!
}
"""
Compliance Issue
"""
type ComplianceIssue {
  productId: ID!
  issueType: String!
  description: String!
  severity: String!
  detectedAt: String!
}
"""
Vendor Dashboard Summary - Optimized for Glance level
"""
type VendorDashboardSummary {
  profile: VendorProfile!
  statistics: VendorStatistics!
  recentSubmissions: [ProductSubmission!]!
  trainingProgress: [VendorTrainingProgress!]!
  qualityScore: Int!
  pendingActions: [PendingAction!]!
}
"""
Pending Action - Things requiring vendor attention
"""
type PendingAction {
  id: ID!
  type: String!
  title: String!
  description: String!
  priority: String!
  dueDate: String
  actionUrl: String
  createdAt: String!
}

# ========================================
# Input Types
# ========================================
"""
Create Vendor Profile Input
"""
input CreateVendorProfileInput {
  vendureSellerId: String!
  companyName: String!
  contactName: String
  contactEmail: String!
  contactPhone: String
  businessLicenseNumber: String
  taxId: String
  websiteUrl: String
  logoUrl: String
  description: String
  establishedYear: Int
  specializations: [String!]
  certifications: JSON
}
"""
Update Vendor Profile Input
"""
input UpdateVendorProfileInput {
  companyName: String
  contactName: String
  contactEmail: String
  contactPhone: String
  businessLicenseNumber: String
  taxId: String
  websiteUrl: String
  logoUrl: String
  description: String
  establishedYear: Int
  specializations: [String!]
  certifications: JSON
}
"""
Submit Product Input
"""
input SubmitProductInput {
  productId: ID!
  trainingCompleted: Boolean!
  guidanceStepsCompleted: JSON
}
"""
Create Product Submission Input - Full product data
"""
input CreateProductSubmissionInput {
  # Product Info
  productName: String!
  brandName: String!
  description: String!
  price: Float!

  # Taxonomy
  categoryId: ID
  functionIds: [ID!]!
  concernIds: [ID!]!
  targetAreaIds: [ID!]!

  # Ingredients
  ingredients: [String!]!
  keyActives: [KeyActiveInput!]!

  # Usage
  usageInstructions: String!
  frequency: String!
  timeOfDay: String!
  warnings: [String!]!

  # Training
  trainingCompleted: Boolean!
}
"""
Key Active Ingredient Input
"""
input KeyActiveInput {
  name: String!
  concentration: Float!
}
"""
Update Product Submission Input
"""
input UpdateProductSubmissionInput {
  submissionStatus: SubmissionStatus
  reviewNotes: String
  rejectionReason: String
}
"""
Start Training Module Input
"""
input StartTrainingModuleInput {
  moduleId: String!
  moduleName: String!
  moduleCategory: String
}
"""
Complete Training Module Input
"""
input CompleteTrainingModuleInput {
  moduleId: String!
  quizScore: Int
  timeSpentMinutes: Int!
}

# ========================================
# Queries
# ========================================

extend type Query {
  """
  Get current vendor's profile
  """
  myVendorProfile: VendorProfile

  """
  Get vendor profile by ID (admin only)
  """
  vendorProfile(id: ID!): VendorProfile

  """
  Get all vendor profiles (admin only)
  """
  vendorProfiles(
    isActive: Boolean
    isVerified: Boolean
    limit: Int
    offset: Int
  ): [VendorProfile!]!

  # Removed: vendorDashboard query - replaced by Feature 011 vendor-portal.graphql
  # which has a more comprehensive vendorDashboard(dateRange: DateRangeInput!): VendorDashboardMetrics!
  #
  # """
  # Get vendor dashboard summary (Glance level data)
  # """
  # vendorDashboard: VendorDashboardSummary!

  """
  Get vendor statistics
  """
  vendorStatistics(
    vendorProfileId: ID
    periodStartDate: String
    periodEndDate: String
  ): VendorStatistics

  """
  Get product submissions for vendor
  """
  productSubmissions(
    vendorProfileId: ID
    submissionStatus: SubmissionStatus
    limit: Int
    offset: Int
  ): [ProductSubmission!]!

  """
  Get single product submission
  """
  productSubmission(id: ID!): ProductSubmission

  """
  Get vendor training progress
  """
  vendorTrainingProgress(
    vendorProfileId: ID
    moduleCategory: String
    status: TrainingStatus
  ): [VendorTrainingProgress!]!

  """
  Get vendor quality metrics
  """
  vendorQualityMetrics(
    vendorProfileId: ID
    periodStartDate: String
    periodEndDate: String
  ): VendorQualityMetrics

  """
  Get pending actions for vendor
  """
  pendingActions(vendorProfileId: ID): [PendingAction!]!
}

# ========================================
# Mutations
# ========================================

extend type Mutation {
  # Removed: vendor profile mutations - replaced by Feature 011 vendor-portal.graphql
  # which has more comprehensive mutations with proper result types
  #
  # """
  # Create vendor profile
  # """
  # createVendorProfile(input: CreateVendorProfileInput!): VendorProfile!
  #
  # """
  # Update vendor profile
  # """
  # updateVendorProfile(id: ID!, input: UpdateVendorProfileInput!): VendorProfile!
  #
  # """
  # Complete vendor onboarding
  # """
  # completeVendorOnboarding(vendorProfileId: ID!): VendorProfile!

  """
  Submit product for review
  """
  submitProduct(input: SubmitProductInput!): ProductSubmission!

  """
  Create new product submission with full data
  """
  createProductSubmission(input: CreateProductSubmissionInput!): ProductSubmission!

  """
  Update product submission (admin only)
  """
  updateProductSubmission(
    id: ID!
    input: UpdateProductSubmissionInput!
  ): ProductSubmission!

  """
  Approve product submission (admin only)
  """
  approveProductSubmission(id: ID!, reviewNotes: String): ProductSubmission!

  """
  Reject product submission (admin only)
  """
  rejectProductSubmission(
    id: ID!
    rejectionReason: String!
    reviewNotes: String
  ): ProductSubmission!

  """
  Request changes to product submission (admin only)
  """
  requestProductChanges(id: ID!, reviewNotes: String!): ProductSubmission!

  """
  Start training module
  """
  startTrainingModule(input: StartTrainingModuleInput!): VendorTrainingProgress!

  """
  Complete training module
  """
  completeTrainingModule(
    input: CompleteTrainingModuleInput!
  ): VendorTrainingProgress!

  """
  Refresh vendor statistics
  """
  refreshVendorStatistics(vendorProfileId: ID!): VendorStatistics!
}
